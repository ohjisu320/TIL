# 25.07.29

### 🔎 어떤 문제가 있었는지

> 파이썬 확인 문제에서 다음 코드를 보고 결과값을 예측하는 문제가 있었다.
>
> ```python
> d = {}
> d.setdefault("key", []).append(100)
> d.setdefault("key", []).append(200)
> print(d)
> ```
>
> 나는 이 결과가 `{'key': [200]}`일 거라고 생각했음.
> 이유는 `setdefault("key", [])`에서 매번 새로운 리스트 `[]`가 만들어진다고 생각했기 때문임.
> 그래서 첫 번째 append는 `[100]`이고, 두 번째 append는 새로 만들어진 `[200]`이 된다고 착각했음.

### 💡 내가 시도해본 것들

> `setdefault()`의 정의를 다시 찾아보며, “없으면 값을 넣고, 있으면 기존 값을 반환한다”는 점을 봤지만
> `default`에 들어가는 `[]`가 호출 시점마다 새로 평가되는 게 아닐까? 하는 의심이 들어, print로 추적해봤다.
>
> 아래처럼 중간 값을 확인해보며 시도함:
>
> ```python
> d = {}
> result1 = d.setdefault("key", [])
> result1.append(100)
> print(d)  # {'key': [100]}
> result2 = d.setdefault("key", [])
> result2.append(200)
> print(d)  # {'key': [100, 200]}
> print(result1 is result2)  # True
> ```

### 🧭 어떻게 해결했는지

> `setdefault("key", [])`는 해당 키가 딕셔너리에 없을 때만 `[]`를 넣고,
> **그 이후에는 기존에 저장된 리스트 객체를 계속 반환한다**는 점을 확인함.
>
> 즉, `[]`는 **한 번만 생성**되고, 이후에는 계속 그 같은 리스트에 `.append()` 되는 구조였던 것!

### 📗 무엇을 새롭게 알았는지

> ✅ `dict.setdefault(key, default)`는 **단 한 번만 default 값을 평가해서 삽입**하고,
> 이후부터는 **이미 존재하는 값을 반환**한다는 사실을 명확히 이해하게 됨.
>
> ✅ `dict.setdefault("key", []).append()` 패턴은 내부적으로는 **같은 리스트 객체에 계속 접근**하는 구조다.
>
> ✔️ 결과적으로 아래 코드는
>
> ```python
> d = {}
> d.setdefault("key", []).append(100)
> d.setdefault("key", []).append(200)
> print(d)
> ```
>
> 이렇게 출력된다:
>
> ```python
> {'key': [100, 200]}
> ```
>
> 즉, 두 번째 `setdefault("key", [])`는 `[]`를 새로 넣는 게 아니라 **이미 존재하는 리스트 `[100]`을 반환**하고, 거기에 `.append(200)`이 되는 것이었다!
